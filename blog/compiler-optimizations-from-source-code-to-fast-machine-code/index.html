<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><title>Compiler Optimizations: From Source Code to Fast Machine Code · Leonardo Benicio</title><meta name=description content="A deep dive into how modern compilers transform your code into efficient machine code. Explore optimization passes from constant folding to loop vectorization, and learn how to write code that compilers can optimize effectively."><link rel=alternate type=application/rss+xml title=RSS href=https://lbenicio.dev/index.xml><link rel=canonical href=https://blog.lbenicio.dev/blog/compiler-optimizations-from-source-code-to-fast-machine-code/><link rel=preload href=/static/fonts/OpenSans-Regular.ttf as=font type=font/ttf crossorigin><link rel="stylesheet" href="/assets/css/fonts.min.40e2054b739ac45a0f9c940f4b44ec00c3b372356ebf61440a413c0337c5512e.css" crossorigin="anonymous" integrity="sha256-QOIFS3OaxFoPnJQPS0TsAMOzcjVuv2FECkE8AzfFUS4="><link rel="shortcut icon" href=/static/assets/favicon/favicon.ico><link rel=icon type=image/x-icon href=/static/assets/favicon/favicon.ico><link rel=icon href=/static/assets/favicon/favicon.svg type=image/svg+xml><link rel=icon href=/static/assets/favicon/favicon-32x32.png sizes=32x32 type=image/png><link rel=icon href=/static/assets/favicon/favicon-16x16.png sizes=16x16 type=image/png><link rel=apple-touch-icon href=/static/assets/favicon/apple-touch-icon.png><link rel=manifest href=/static/assets/favicon/site.webmanifest><link rel=mask-icon href=/static/assets/favicon/safari-pinned-tab.svg color=#209cee><meta name=msapplication-TileColor content="#209cee"><meta name=msapplication-config content="/static/assets/favicon/browserconfig.xml"><meta name=theme-color content="#d2e9f8"><meta property="og:title" content="Compiler Optimizations: From Source Code to Fast Machine Code · Leonardo Benicio"><meta property="og:description" content="A deep dive into how modern compilers transform your code into efficient machine code. Explore optimization passes from constant folding to loop vectorization, and learn how to write code that compilers can optimize effectively."><meta property="og:url" content="https://blog.lbenicio.dev/blog/compiler-optimizations-from-source-code-to-fast-machine-code/"><meta property="og:type" content="article"><meta property="og:image" content="https://blog.lbenicio.dev/static/assets/images/blog/compiler-optimizations-source-to-machine-code.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Compiler Optimizations: From Source Code to Fast Machine Code · Leonardo Benicio"><meta name=twitter:description content="A deep dive into how modern compilers transform your code into efficient machine code. Explore optimization passes from constant folding to loop vectorization, and learn how to write code that compilers can optimize effectively."><meta name=twitter:site content="@lbenicio_"><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"About Leonardo Benicio","url":"https://blog.lbenicio.dev"}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"Person","name":"Leonardo Benicio","sameAs":["https://github.com/lbenicio","https://www.linkedin.com/in/leonardo-benicio","https://twitter.com/lbenicio_"],"url":"https://blog.lbenicio.dev"}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://blog.lbenicio.dev/","name":"Home","position":1},{"@type":"ListItem","item":"https://blog.lbenicio.dev/","name":"Blog","position":2},{"@type":"ListItem","item":"https://blog.lbenicio.dev/blog/compiler-optimizations-from-source-code-to-fast-machine-code/","name":"Compiler Optimizations From Source Code to Fast Machine Code","position":3}]}</script><link rel="stylesheet" href="/assets/css/main.min.1e8a566ac8bc3f0664d0db4ec8a015b07421c33fa11d336a6b914522a9cabf30.css" crossorigin="anonymous" integrity="sha256-6lhUOpwCHMSMROmggsVSp3AHKud6gBrIFGTzl3GV4BY="></head><body class="c6942b3 c03620d cf3bd2e"><script>(function(){try{document.addEventListener("gesturestart",function(e){e.preventDefault()}),document.addEventListener("touchstart",function(e){e.touches&&e.touches.length>1&&e.preventDefault()},{passive:!1});var e=0;document.addEventListener("touchend",function(t){var n=Date.now();n-e<=300&&t.preventDefault(),e=n},{passive:!1})}catch{}})()</script><a href=#content class="cba5854 c21e770 caffa6e cc5f604 cf2c31d cdd44dd c10dda9 c43876e c787e9b cddc2d2 cf55a7b c6dfb1e c9391e2">Skip to content</a>
<script>(function(){try{const e=localStorage.getItem("theme");e==="dark"&&document.documentElement.classList.add("dark");const t=document.querySelector('button[aria-label="Toggle theme"]');t&&t.setAttribute("aria-pressed",String(e==="dark"))}catch{}})();function toggleTheme(e){const s=document.documentElement,t=s.classList.toggle("dark");try{localStorage.setItem("theme",t?"dark":"light")}catch{}try{var n=e&&e.nodeType===1?e:document.querySelector('button[aria-label="Toggle theme"]');n&&n.setAttribute("aria-pressed",String(!!t))}catch{}}(function(){function e(){try{return document.documentElement.classList.contains("dark")?"dark":"light"}catch{return"light"}}function n(t){const n=document.getElementById("i98aca2"),s=document.getElementById("iad2af0"),o=document.getElementById("i975fb5");if(!n||!s||!o)return;try{n.style.transform="translateX(0)",n.style.transition||(n.style.transition="transform 200ms ease-out")}catch{}try{s.hidden=!1,s.style.display="block"}catch{}o.setAttribute("aria-expanded","true"),n.setAttribute("aria-hidden","false");try{document.body.classList.add("c150bbe")}catch{}const i=document.getElementById("i190984");i&&i.focus();try{window.umami&&typeof window.umami.track=="function"&&window.umami.track("mobile_menu_open",{page:location.pathname,theme:e(),source:t||"programmatic"})}catch{}}function t(t){const n=document.getElementById("i98aca2"),s=document.getElementById("iad2af0"),o=document.getElementById("i975fb5");if(!n||!s||!o)return;try{n.style.transform="translateX(100%)",n.style.transition||(n.style.transition="transform 200ms ease-out")}catch{}try{s.hidden=!0,s.style.display="none"}catch{}o.setAttribute("aria-expanded","false"),n.setAttribute("aria-hidden","true");try{document.body.classList.remove("c150bbe")}catch{}o.focus();try{window.umami&&typeof window.umami.track=="function"&&window.umami.track("mobile_menu_close",{page:location.pathname,theme:e(),source:t||"programmatic"})}catch{}}function s(e){e.key==="Escape"&&t("escape")}window.__openMobileMenu=n,window.__closeMobileMenu=t;try{window.addEventListener("keydown",s,!0)}catch{}})()</script><header class="cd019ba c98dfae cdd44dd cfdda01 c9ee25d ce2dc7a cd72dd7 cc0dc37" role=banner><div class="cfdda01 c6942b3 ccf47f4 c7c11d8"><a href=/ class="c87e2b0 c6942b3 c7c11d8 c1838fa cb594e4" aria-label=Home><img src=/static/assets/favicon/favicon.svg alt=Logo width=32 height=32 class="c3de71a c4d5191">
<span class="cf8f011 c4d1253 cbd72bc cd7e69e">Leonardo Benicio</span></a><div class="c6942b3 c85cbd4 c7c11d8 ca798da c1838fa c7a0580"><nav class="cc1689c cd9b445 c75065d c04bab1" aria-label=Main><a href=/ class="c4d1253 c9e4539 cbbda39 c01f421 c19ee42 c3ecea6">Home</a>
<a href=https://lbenicio.dev/about target=_blank rel="noopener noreferrer" class="c4d1253 c9e4539 cbbda39 c01f421 c19ee42 c3ecea6">About</a>
<a href=https://lbenicio.dev/timeline target=_blank rel="noopener noreferrer" class="c4d1253 c9e4539 cbbda39 c01f421 c19ee42 c3ecea6">Timeline</a>
<a href=https://lbenicio.dev/reading target=_blank rel="noopener noreferrer" class="c4d1253 c9e4539 cbbda39 c01f421 c19ee42 c3ecea6">Reading</a>
<a href=https://publications.lbenicio.dev target=_blank rel="noopener noreferrer" class="c4d1253 c9e4539 cbbda39 c01f421 c19ee42 c3ecea6">Publications</a>
<a href=https://lbenicio.dev/contact target=_blank rel="noopener noreferrer" class="c4d1253 c9e4539 cbbda39 c01f421 c19ee42 c3ecea6">Contact</a></nav><button id="i1d73d4" type=button class="c1d6c20 c81ac7c c6a899b c7c11d8 c1d0018 c10dda9 c8e184d c514027 c88daee c7a66a6 c097fa1 cfc01c7 c286dd7 c2bd687 cfdce1d cfef18f" onclick=toggleTheme(this) aria-label="Toggle theme" aria-pressed=false title="Toggle theme">
<svg class="cb26e41 c50ceea cb69a5c c4f45c8 c8c2c40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg class="cb26e41 c8fca2b cb69a5c c4f45c8 cc1689c c9c27ff" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="12" cy="12" r="4"/><path d="M12 2v4"/><path d="M12 18v4"/><path d="M2 12h4"/><path d="M18 12h4"/><path d="M4.93 4.93l2.83 2.83"/><path d="M16.24 16.24l2.83 2.83"/><path d="M6.34 17.66l2.83-2.83"/><path d="M14.83 9.17l2.83-2.83"/></svg>
<span class="cba5854">Toggle theme</span></button><div class="c658bcf c097fa1"><button id="i975fb5" type=button class="c1d6c20 c81ac7c c6a899b c7c11d8 c1d0018 c10dda9 c8e184d c514027 c88daee c7a66a6 cfc01c7 c286dd7 c2bd687 cfdce1d cfef18f" aria-label="Open menu" aria-controls="i98aca2" aria-expanded=false onclick='window.__openMobileMenu("button")' data-d38f920=mobile_menu_open_click>
<svg class="c20e4eb cb58471" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
<span class="cba5854">Open menu</span></button></div></div></div></header><div id="iad2af0" class="caffa6e ce4b5f4 c14639a" style=background-color:hsl(var(--background)) hidden onclick='window.__closeMobileMenu("overlay")' data-d38f920=mobile_menu_overlay_click></div><aside id="i98aca2" class="caffa6e c9efbc5 c437fa9 c49e97e c6c6936 c7cacca c7b34a4 c787e9b c88daee cad071a c6942b3 c03620d" role=dialog aria-modal=true aria-hidden=true aria-label="Mobile navigation" style="transform:translateX(100%);transition:transform 200ms ease-out;will-change:transform"><div class="c6942b3 c7c11d8 c82c52d c5df473 ccf47f4 c9ee25d"><a href=/ class="c6942b3 c7c11d8 c1838fa" aria-label=Home><img src=/static/assets/favicon/favicon.svg alt=Logo width=24 height=24 class="c20e4eb cb58471">
<span class="c62aaf0 c7c1b66 cbd72bc">Leonardo Benicio</span>
</a><button id="i190984" type=button class="c1d6c20 c81ac7c c6a899b c7c11d8 c1d0018 c10dda9 c514027 c286dd7 c2bd687 cfdce1d" aria-label="Close menu" onclick='window.__closeMobileMenu("button")' data-d38f920=mobile_menu_close_click>
<svg class="c16e528 c61f467" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
<span class="cba5854">Close</span></button></div><nav class="c85cbd4 ca0eaa4 c5df473 c6689b9"><ul class="cd69733"><li><a href=/ class="c3b5299 c10dda9 cddc2d2 cf55a7b c7c1b66 cbbda39 c3ecea6 c19ee42 c514027" onclick=window.__closeMobileMenu()>Home</a></li><li><a href=https://lbenicio.dev/about target=_blank rel="noopener noreferrer" class="c3b5299 c10dda9 cddc2d2 cf55a7b c7c1b66 cbbda39 c3ecea6 c19ee42 c514027" onclick=window.__closeMobileMenu()>About</a></li><li><a href=https://lbenicio.dev/timeline target=_blank rel="noopener noreferrer" class="c3b5299 c10dda9 cddc2d2 cf55a7b c7c1b66 cbbda39 c3ecea6 c19ee42 c514027" onclick=window.__closeMobileMenu()>Timeline</a></li><li><a href=https://lbenicio.dev/reading target=_blank rel="noopener noreferrer" class="c3b5299 c10dda9 cddc2d2 cf55a7b c7c1b66 cbbda39 c3ecea6 c19ee42 c514027" onclick=window.__closeMobileMenu()>Reading</a></li><li><a href=https://publications.lbenicio.dev target=_blank rel="noopener noreferrer" class="c3b5299 c10dda9 cddc2d2 cf55a7b c7c1b66 cbbda39 c3ecea6 c19ee42 c514027" onclick=window.__closeMobileMenu()>Publications</a></li><li><a href=https://lbenicio.dev/contact target=_blank rel="noopener noreferrer" class="c3b5299 c10dda9 cddc2d2 cf55a7b c7c1b66 cbbda39 c3ecea6 c19ee42 c514027" onclick=window.__closeMobileMenu()>Contact</a></li></ul></nav><div class="c60a4cc ccdf0e8 c277478 c13044e"><p>&copy; 2026 Leonardo Benicio</p></div></aside><div class="caffa6e c437fa9 ce9aced c97bba6 c15da2a c975cba" role=complementary aria-label="GitHub repository"><div class="c9d056d c252f85 ca22532 ca88a1a c876315"><div class="c6942b3 c7c11d8 c1d0018 cd1fd22 c6066e4 c43876e ce3d5b6 caa20d2 c3ecea6 c0cd2e2 cddc2d2 c3ed5c9 cd4074c c876315"><a href=https://github.com/lbenicio/aboutme target=_blank rel="noopener noreferrer" class="c6942b3 c7c11d8 cd1fd22 c71bae8 cfac1ac c19ee42 c25dc7c cb40739 cbbda39 cf55a7b" aria-label="View source on GitHub"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="cb26e41 c41bcd4 cf17690 cfa4e34 c78d562" aria-hidden="true"><path d="M15 22v-4a4.8 4.8.0 00-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35.0-3.5.0.0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35.0 3.5A5.403 5.403.0 004 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
<span class="cb5c327 cd7e69e">Fork me</span></a></div></div></div><main id="i7eccc0" class="cfdda01 c5df473 c0eecc8 c85cbd4" role=main aria-label=Content><nav class="cb545ce c8d8ae4 c277478" aria-label=Breadcrumb><ol class="c6942b3 c3adaf2 c7c11d8 cd365ee c3ecea6"><li><a href=/ class="c19ee42 c71bae8 cfac1ac">Home</a></li><li class="c6942b3 c7c11d8 cd365ee"><span class="cb82ddd">/</span><a href=/ class="c19ee42 c71bae8 cfac1ac">Blog</a></li><li class="c6942b3 c7c11d8 cd365ee"><span class="cb82ddd">/</span><span class="c88daee">Compiler Optimizations From Source Code to Fast Machine Code</span></li></ol></nav><article class="c461ba0 c1c203f cfb6084 c995404 c6ca165"><nav class="cb545ce c8d8ae4 c277478" aria-label=Breadcrumb><ol class="c6942b3 c3adaf2 c7c11d8 cd365ee c3ecea6"><li><a href=/ class="c19ee42 c71bae8 cfac1ac">Home</a></li><li class="c6942b3 c7c11d8 cd365ee"><span class="cb82ddd">/</span><a href=/ class="c19ee42 c71bae8 cfac1ac">Blog</a></li><li class="c6942b3 c7c11d8 cd365ee"><span class="cb82ddd">/</span><span class="c88daee">Compiler Optimizations From Source Code to Fast Machine Code</span></li></ol></nav><header class="c8aedc7"><h1 class="cf304bc c6fb0fe cf8f011 cc484e1">Compiler Optimizations: From Source Code to Fast Machine Code</h1><div class="c277478 c3ecea6 c8fb24a">2020-09-23
· Leonardo Benicio</div><div class="c1a1a3f c8124f2"><img src=/static/assets/images/blog/compiler-optimizations-source-to-machine-code.png alt class="cfdda01 c524300 c677556"></div><p class="lead c3ecea6">A deep dive into how modern compilers transform your code into efficient machine code. Explore optimization passes from constant folding to loop vectorization, and learn how to write code that compilers can optimize effectively.</p></header><div class="content"><p>When you compile your code with <code>-O2</code> or <code>-O3</code>, something magical happens. The compiler applies dozens of optimization passes that can make your program run 10x faster—or more. Understanding these optimizations helps you write faster code and debug mysterious performance issues. Let&rsquo;s explore how modern compilers transform source code into efficient machine code.</p><h2 id="1-the-compilation-pipeline">1. The Compilation Pipeline</h2><p>Before diving into optimizations, let&rsquo;s understand where they happen.</p><h3 id="11-compiler-phases">1.1 Compiler Phases</h3><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-text" data-lang=text><span style=display:flex><span>Source Code
</span></span><span style=display:flex><span>    │
</span></span><span style=display:flex><span>    ▼
</span></span><span style=display:flex><span>┌─────────────────┐
</span></span><span style=display:flex><span>│   Front-end     │  Parsing, type checking, AST generation
</span></span><span style=display:flex><span>│  (Language-     │  C, C++, Rust, Swift → IR
</span></span><span style=display:flex><span>│   specific)     │
</span></span><span style=display:flex><span>└────────┬────────┘
</span></span><span style=display:flex><span>         │
</span></span><span style=display:flex><span>         ▼
</span></span><span style=display:flex><span>┌─────────────────┐
</span></span><span style=display:flex><span>│  Middle-end     │  ★ MOST OPTIMIZATIONS HAPPEN HERE ★
</span></span><span style=display:flex><span>│  (IR-based      │  Constant folding, inlining, loop opts
</span></span><span style=display:flex><span>│   optimization) │  Dead code elimination, vectorization
</span></span><span style=display:flex><span>└────────┬────────┘
</span></span><span style=display:flex><span>         │
</span></span><span style=display:flex><span>         ▼
</span></span><span style=display:flex><span>┌─────────────────┐
</span></span><span style=display:flex><span>│   Back-end      │  Instruction selection, register allocation
</span></span><span style=display:flex><span>│  (Target-       │  Instruction scheduling, peephole opts
</span></span><span style=display:flex><span>│   specific)     │
</span></span><span style=display:flex><span>└────────┬────────┘
</span></span><span style=display:flex><span>         │
</span></span><span style=display:flex><span>         ▼
</span></span><span style=display:flex><span>   Machine Code
</span></span></code></pre></div><h3 id="12-intermediate-representation-ir">1.2 Intermediate Representation (IR)</h3><p>LLVM IR is a popular intermediate representation:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-llvm" data-lang=llvm><span style=display:flex><span><span style=color:#8b949e;font-style:italic>; Source: int square(int x) { return x * x; }
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>define</span> <span style=color:#ff7b72>i32</span> <span style=color:#79c0ff>@square</span>(<span style=color:#ff7b72>i32</span> <span style=color:#79c0ff>%x</span>) {
</span></span><span style=display:flex><span><span style=color:#79c0ff;font-weight:700>entry:</span>
</span></span><span style=display:flex><span>  <span style=color:#79c0ff>%result</span> = <span style=color:#ff7b72>mul</span> <span style=color:#ff7b72>i32</span> <span style=color:#79c0ff>%x</span>, <span style=color:#79c0ff>%x</span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>ret</span> <span style=color:#ff7b72>i32</span> <span style=color:#79c0ff>%result</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>IR enables language-agnostic optimization: the same optimization passes work for C, C++, Rust, Swift, and other LLVM-based languages.</p><h3 id="13-optimization-levels">1.3 Optimization Levels</h3><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-bash" data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># GCC/Clang optimization levels</span>
</span></span><span style=display:flex><span>-O0  <span style=color:#8b949e;font-style:italic># No optimization (fast compile, slow code)</span>
</span></span><span style=display:flex><span>-O1  <span style=color:#8b949e;font-style:italic># Basic optimizations</span>
</span></span><span style=display:flex><span>-O2  <span style=color:#8b949e;font-style:italic># Most optimizations (production default)</span>
</span></span><span style=display:flex><span>-O3  <span style=color:#8b949e;font-style:italic># Aggressive (may increase code size)</span>
</span></span><span style=display:flex><span>-Os  <span style=color:#8b949e;font-style:italic># Optimize for size</span>
</span></span><span style=display:flex><span>-Ofast  <span style=color:#8b949e;font-style:italic># O3 + unsafe math optimizations</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># View applied passes (Clang)</span>
</span></span><span style=display:flex><span>clang -O2 -mllvm -print-pipeline-passes file.c
</span></span></code></pre></div><h2 id="2-scalar-optimizations">2. Scalar Optimizations</h2><p>The simplest optimizations work on individual values and expressions.</p><h3 id="21-constant-folding">2.1 Constant Folding</h3><p>Evaluate constant expressions at compile time:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Before
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> x <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>2</span> <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>3</span>;
</span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> y <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>60</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>60</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>24</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// After constant folding
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> x <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>5</span>;
</span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> y <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>86400</span>;
</span></span></code></pre></div><p>This extends to function calls with constant arguments:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Before
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>double</span> pi_squared <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#d2a8ff;font-weight:700>pow</span>(<span style=color:#a5d6ff>3.14159</span>, <span style=color:#a5d6ff>2</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// After (with -O2)
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>double</span> pi_squared <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>9.869587728099999</span>;
</span></span></code></pre></div><h3 id="22-constant-propagation">2.2 Constant Propagation</h3><p>Substitute known constant values:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Before
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> a <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>5</span>;
</span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> b <span style=color:#ff7b72;font-weight:700>=</span> a <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>3</span>;
</span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> c <span style=color:#ff7b72;font-weight:700>=</span> b <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>2</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// After constant propagation
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> a <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>5</span>;
</span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> b <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>8</span>;    <span style=color:#8b949e;font-style:italic>// 5 + 3
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> c <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>16</span>;   <span style=color:#8b949e;font-style:italic>// 8 * 2
</span></span></span></code></pre></div><h3 id="23-dead-code-elimination">2.3 Dead Code Elimination</h3><p>Remove code that doesn&rsquo;t affect output:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Before
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> <span style=color:#d2a8ff;font-weight:700>compute</span>(<span style=color:#ff7b72>int</span> x) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>int</span> unused <span style=color:#ff7b72;font-weight:700>=</span> x <span style=color:#ff7b72;font-weight:700>*</span> x <span style=color:#ff7b72;font-weight:700>*</span> x;  <span style=color:#8b949e;font-style:italic>// Never used
</span></span></span><span style=display:flex><span>    <span style=color:#ff7b72>int</span> result <span style=color:#ff7b72;font-weight:700>=</span> x <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>2</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> result;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// After DCE
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> <span style=color:#d2a8ff;font-weight:700>compute</span>(<span style=color:#ff7b72>int</span> x) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> x <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>2</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id="24-common-subexpression-elimination-cse">2.4 Common Subexpression Elimination (CSE)</h3><p>Compute repeated expressions once:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Before
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>double</span> distance <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#d2a8ff;font-weight:700>sqrt</span>(x<span style=color:#ff7b72;font-weight:700>*</span>x <span style=color:#ff7b72;font-weight:700>+</span> y<span style=color:#ff7b72;font-weight:700>*</span>y);
</span></span><span style=display:flex><span><span style=color:#ff7b72>double</span> normalized_x <span style=color:#ff7b72;font-weight:700>=</span> x <span style=color:#ff7b72;font-weight:700>/</span> <span style=color:#d2a8ff;font-weight:700>sqrt</span>(x<span style=color:#ff7b72;font-weight:700>*</span>x <span style=color:#ff7b72;font-weight:700>+</span> y<span style=color:#ff7b72;font-weight:700>*</span>y);
</span></span><span style=display:flex><span><span style=color:#ff7b72>double</span> normalized_y <span style=color:#ff7b72;font-weight:700>=</span> y <span style=color:#ff7b72;font-weight:700>/</span> <span style=color:#d2a8ff;font-weight:700>sqrt</span>(x<span style=color:#ff7b72;font-weight:700>*</span>x <span style=color:#ff7b72;font-weight:700>+</span> y<span style=color:#ff7b72;font-weight:700>*</span>y);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// After CSE
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>double</span> temp <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#d2a8ff;font-weight:700>sqrt</span>(x<span style=color:#ff7b72;font-weight:700>*</span>x <span style=color:#ff7b72;font-weight:700>+</span> y<span style=color:#ff7b72;font-weight:700>*</span>y);
</span></span><span style=display:flex><span><span style=color:#ff7b72>double</span> distance <span style=color:#ff7b72;font-weight:700>=</span> temp;
</span></span><span style=display:flex><span><span style=color:#ff7b72>double</span> normalized_x <span style=color:#ff7b72;font-weight:700>=</span> x <span style=color:#ff7b72;font-weight:700>/</span> temp;
</span></span><span style=display:flex><span><span style=color:#ff7b72>double</span> normalized_y <span style=color:#ff7b72;font-weight:700>=</span> y <span style=color:#ff7b72;font-weight:700>/</span> temp;
</span></span></code></pre></div><h3 id="25-strength-reduction">2.5 Strength Reduction</h3><p>Replace expensive operations with cheaper equivalents:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Before
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> y <span style=color:#ff7b72;font-weight:700>=</span> x <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>2</span>;
</span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> z <span style=color:#ff7b72;font-weight:700>=</span> x <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>8</span>;
</span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> w <span style=color:#ff7b72;font-weight:700>=</span> x <span style=color:#ff7b72;font-weight:700>/</span> <span style=color:#a5d6ff>4</span>;
</span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> v <span style=color:#ff7b72;font-weight:700>=</span> x <span style=color:#ff7b72;font-weight:700>%</span> <span style=color:#a5d6ff>8</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// After strength reduction
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> y <span style=color:#ff7b72;font-weight:700>=</span> x <span style=color:#ff7b72;font-weight:700>&lt;&lt;</span> <span style=color:#a5d6ff>1</span>;      <span style=color:#8b949e;font-style:italic>// Shift instead of multiply
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> z <span style=color:#ff7b72;font-weight:700>=</span> x <span style=color:#ff7b72;font-weight:700>&lt;&lt;</span> <span style=color:#a5d6ff>3</span>;      <span style=color:#8b949e;font-style:italic>// Shift instead of multiply
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> w <span style=color:#ff7b72;font-weight:700>=</span> x <span style=color:#ff7b72;font-weight:700>&gt;&gt;</span> <span style=color:#a5d6ff>2</span>;      <span style=color:#8b949e;font-style:italic>// Shift instead of divide (for positive x)
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> v <span style=color:#ff7b72;font-weight:700>=</span> x <span style=color:#ff7b72;font-weight:700>&amp;</span> <span style=color:#a5d6ff>7</span>;       <span style=color:#8b949e;font-style:italic>// AND instead of modulo (for power of 2)
</span></span></span></code></pre></div><h3 id="26-algebraic-simplification">2.6 Algebraic Simplification</h3><p>Apply mathematical identities:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Before
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> a <span style=color:#ff7b72;font-weight:700>=</span> x <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>0</span>;
</span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> b <span style=color:#ff7b72;font-weight:700>=</span> x <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>1</span>;
</span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> c <span style=color:#ff7b72;font-weight:700>=</span> x <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>0</span>;
</span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> d <span style=color:#ff7b72;font-weight:700>=</span> x <span style=color:#ff7b72;font-weight:700>-</span> x;
</span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> e <span style=color:#ff7b72;font-weight:700>=</span> x <span style=color:#ff7b72;font-weight:700>|</span> <span style=color:#a5d6ff>0</span>;
</span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> f <span style=color:#ff7b72;font-weight:700>=</span> x <span style=color:#ff7b72;font-weight:700>&amp;</span> x;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// After simplification
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> a <span style=color:#ff7b72;font-weight:700>=</span> x;
</span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> b <span style=color:#ff7b72;font-weight:700>=</span> x;
</span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> c <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>;
</span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> d <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>;
</span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> e <span style=color:#ff7b72;font-weight:700>=</span> x;
</span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> f <span style=color:#ff7b72;font-weight:700>=</span> x;
</span></span></code></pre></div><h2 id="3-control-flow-optimizations">3. Control Flow Optimizations</h2><p>Optimizations that restructure how code executes.</p><h3 id="31-inlining">3.1 Inlining</h3><p>Replace function calls with function body:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Before
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>static</span> <span style=color:#ff7b72>inline</span> <span style=color:#ff7b72>int</span> <span style=color:#d2a8ff;font-weight:700>square</span>(<span style=color:#ff7b72>int</span> x) { <span style=color:#ff7b72>return</span> x <span style=color:#ff7b72;font-weight:700>*</span> x; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> <span style=color:#d2a8ff;font-weight:700>compute</span>(<span style=color:#ff7b72>int</span> a, <span style=color:#ff7b72>int</span> b) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> <span style=color:#d2a8ff;font-weight:700>square</span>(a) <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#d2a8ff;font-weight:700>square</span>(b);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// After inlining
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> <span style=color:#d2a8ff;font-weight:700>compute</span>(<span style=color:#ff7b72>int</span> a, <span style=color:#ff7b72>int</span> b) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> a <span style=color:#ff7b72;font-weight:700>*</span> a <span style=color:#ff7b72;font-weight:700>+</span> b <span style=color:#ff7b72;font-weight:700>*</span> b;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Inlining eliminates:</p><ul><li>Function call overhead</li><li>Argument passing</li><li>Return handling</li><li>Enables further optimizations</li></ul><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Inlining enables more optimization
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> <span style=color:#d2a8ff;font-weight:700>process</span>(<span style=color:#ff7b72>int</span> x) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (x <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>0</span>) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#d2a8ff;font-weight:700>abs</span>(x);  <span style=color:#8b949e;font-style:italic>// abs() inlined
</span></span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// After inlining + simplification
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> <span style=color:#d2a8ff;font-weight:700>process</span>(<span style=color:#ff7b72>int</span> x) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (x <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>0</span>) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> x;  <span style=color:#8b949e;font-style:italic>// We know x &gt; 0, so abs(x) = x
</span></span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id="32-tail-call-optimization">3.2 Tail Call Optimization</h3><p>Convert tail recursion to iteration:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Before (recursive)
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> <span style=color:#d2a8ff;font-weight:700>factorial</span>(<span style=color:#ff7b72>int</span> n, <span style=color:#ff7b72>int</span> acc) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (n <span style=color:#ff7b72;font-weight:700>&lt;=</span> <span style=color:#a5d6ff>1</span>) <span style=color:#ff7b72>return</span> acc;
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> <span style=color:#d2a8ff;font-weight:700>factorial</span>(n <span style=color:#ff7b72;font-weight:700>-</span> <span style=color:#a5d6ff>1</span>, n <span style=color:#ff7b72;font-weight:700>*</span> acc);  <span style=color:#8b949e;font-style:italic>// Tail call
</span></span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// After TCO (effectively)
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> <span style=color:#d2a8ff;font-weight:700>factorial</span>(<span style=color:#ff7b72>int</span> n, <span style=color:#ff7b72>int</span> acc) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>while</span> (n <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>1</span>) {
</span></span><span style=display:flex><span>        acc <span style=color:#ff7b72;font-weight:700>=</span> n <span style=color:#ff7b72;font-weight:700>*</span> acc;
</span></span><span style=display:flex><span>        n <span style=color:#ff7b72;font-weight:700>=</span> n <span style=color:#ff7b72;font-weight:700>-</span> <span style=color:#a5d6ff>1</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> acc;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This prevents stack overflow and improves performance.</p><h3 id="33-branch-elimination">3.3 Branch Elimination</h3><p>Remove branches with known outcomes:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Before
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>process</span>(<span style=color:#ff7b72>int</span> <span style=color:#ff7b72;font-weight:700>*</span>ptr) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (ptr <span style=color:#ff7b72;font-weight:700>==</span> NULL) {
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// Handle null
</span></span></span><span style=display:flex><span>    } <span style=color:#ff7b72>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72;font-weight:700>*</span>ptr <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>42</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (ptr <span style=color:#ff7b72;font-weight:700>!=</span> NULL) {  <span style=color:#8b949e;font-style:italic>// Redundant check
</span></span></span><span style=display:flex><span>        <span style=color:#d2a8ff;font-weight:700>printf</span>(<span style=color:#a5d6ff>&#34;%d</span><span style=color:#79c0ff>\n</span><span style=color:#a5d6ff>&#34;</span>, <span style=color:#ff7b72;font-weight:700>*</span>ptr);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// After branch elimination (in else branch context)
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>process</span>(<span style=color:#ff7b72>int</span> <span style=color:#ff7b72;font-weight:700>*</span>ptr) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (ptr <span style=color:#ff7b72;font-weight:700>==</span> NULL) {
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// Handle null
</span></span></span><span style=display:flex><span>    } <span style=color:#ff7b72>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72;font-weight:700>*</span>ptr <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>42</span>;
</span></span><span style=display:flex><span>        <span style=color:#d2a8ff;font-weight:700>printf</span>(<span style=color:#a5d6ff>&#34;%d</span><span style=color:#79c0ff>\n</span><span style=color:#a5d6ff>&#34;</span>, <span style=color:#ff7b72;font-weight:700>*</span>ptr);  <span style=color:#8b949e;font-style:italic>// We know ptr != NULL
</span></span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id="34-loop-invariant-code-motion">3.4 Loop-Invariant Code Motion</h3><p>Move computations out of loops:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Before
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> n; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>    result[i] <span style=color:#ff7b72;font-weight:700>=</span> data[i] <span style=color:#ff7b72;font-weight:700>*</span> (a <span style=color:#ff7b72;font-weight:700>+</span> b) <span style=color:#ff7b72;font-weight:700>/</span> c;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// After LICM
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> temp <span style=color:#ff7b72;font-weight:700>=</span> (a <span style=color:#ff7b72;font-weight:700>+</span> b) <span style=color:#ff7b72;font-weight:700>/</span> c;  <span style=color:#8b949e;font-style:italic>// Moved out of loop
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> n; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>    result[i] <span style=color:#ff7b72;font-weight:700>=</span> data[i] <span style=color:#ff7b72;font-weight:700>*</span> temp;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id="35-jump-threading">3.5 Jump Threading</h3><p>Eliminate unnecessary jumps:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Before
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>if</span> (x <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>0</span>) {
</span></span><span style=display:flex><span>    flag <span style=color:#ff7b72;font-weight:700>=</span> true;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#ff7b72>if</span> (flag) {  <span style=color:#8b949e;font-style:italic>// Redundant when x &gt; 0
</span></span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>do_something</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// After jump threading (when x &gt; 0)
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>if</span> (x <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>0</span>) {
</span></span><span style=display:flex><span>    flag <span style=color:#ff7b72;font-weight:700>=</span> true;
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>do_something</span>();  <span style=color:#8b949e;font-style:italic>// Directly threaded
</span></span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#ff7b72>if</span> (flag <span style=color:#ff7b72;font-weight:700>&amp;&amp;</span> x <span style=color:#ff7b72;font-weight:700>&lt;=</span> <span style=color:#a5d6ff>0</span>) {  <span style=color:#8b949e;font-style:italic>// Only check when needed
</span></span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>do_something</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id="4-loop-optimizations">4. Loop Optimizations</h2><p>Loops are where programs spend most of their time, so they receive special attention.</p><h3 id="41-loop-unrolling">4.1 Loop Unrolling</h3><p>Execute multiple iterations per loop:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Before
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> <span style=color:#a5d6ff>100</span>; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>    sum <span style=color:#ff7b72;font-weight:700>+=</span> array[i];
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// After unrolling (factor of 4)
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> <span style=color:#a5d6ff>100</span>; i <span style=color:#ff7b72;font-weight:700>+=</span> <span style=color:#a5d6ff>4</span>) {
</span></span><span style=display:flex><span>    sum <span style=color:#ff7b72;font-weight:700>+=</span> array[i];
</span></span><span style=display:flex><span>    sum <span style=color:#ff7b72;font-weight:700>+=</span> array[i <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>1</span>];
</span></span><span style=display:flex><span>    sum <span style=color:#ff7b72;font-weight:700>+=</span> array[i <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>2</span>];
</span></span><span style=display:flex><span>    sum <span style=color:#ff7b72;font-weight:700>+=</span> array[i <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>3</span>];
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Benefits:</p><ul><li>Fewer branch instructions</li><li>Better instruction-level parallelism</li><li>Enables more CSE opportunities</li></ul><h3 id="42-loop-fusion">4.2 Loop Fusion</h3><p>Combine adjacent loops:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Before
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> n; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>    a[i] <span style=color:#ff7b72;font-weight:700>=</span> b[i] <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>1</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> n; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>    c[i] <span style=color:#ff7b72;font-weight:700>=</span> a[i] <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>2</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// After fusion
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> n; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>    a[i] <span style=color:#ff7b72;font-weight:700>=</span> b[i] <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>1</span>;
</span></span><span style=display:flex><span>    c[i] <span style=color:#ff7b72;font-weight:700>=</span> a[i] <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>2</span>;  <span style=color:#8b949e;font-style:italic>// Better cache locality
</span></span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id="43-loop-fission-distribution">4.3 Loop Fission (Distribution)</h3><p>Split a loop into multiple loops:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Before (poor vectorization due to dependency)
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> n; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>    a[i] <span style=color:#ff7b72;font-weight:700>=</span> b[i] <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>1</span>;      <span style=color:#8b949e;font-style:italic>// Can vectorize
</span></span></span><span style=display:flex><span>    c[i] <span style=color:#ff7b72;font-weight:700>=</span> c[i<span style=color:#ff7b72;font-weight:700>-</span><span style=color:#a5d6ff>1</span>] <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>2</span>;    <span style=color:#8b949e;font-style:italic>// Cannot vectorize (dependency)
</span></span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// After fission
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> n; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>    a[i] <span style=color:#ff7b72;font-weight:700>=</span> b[i] <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>1</span>;      <span style=color:#8b949e;font-style:italic>// Now vectorizable
</span></span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> n; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>    c[i] <span style=color:#ff7b72;font-weight:700>=</span> c[i<span style=color:#ff7b72;font-weight:700>-</span><span style=color:#a5d6ff>1</span>] <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>2</span>;    <span style=color:#8b949e;font-style:italic>// Sequential
</span></span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id="44-loop-interchange">4.4 Loop Interchange</h3><p>Swap nested loop order for better memory access:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Before (poor cache behavior - column-major access)
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> j <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; j <span style=color:#ff7b72;font-weight:700>&lt;</span> N; j<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> M; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>        sum <span style=color:#ff7b72;font-weight:700>+=</span> matrix[i][j];  <span style=color:#8b949e;font-style:italic>// Strided access
</span></span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// After interchange (row-major access)
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> M; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> j <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; j <span style=color:#ff7b72;font-weight:700>&lt;</span> N; j<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>        sum <span style=color:#ff7b72;font-weight:700>+=</span> matrix[i][j];  <span style=color:#8b949e;font-style:italic>// Sequential access
</span></span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id="45-loop-vectorization">4.5 Loop Vectorization</h3><p>Use SIMD instructions to process multiple elements:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Before
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> n; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>    c[i] <span style=color:#ff7b72;font-weight:700>=</span> a[i] <span style=color:#ff7b72;font-weight:700>+</span> b[i];
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// After vectorization (conceptually)
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> n; i <span style=color:#ff7b72;font-weight:700>+=</span> <span style=color:#a5d6ff>8</span>) {  <span style=color:#8b949e;font-style:italic>// Process 8 floats at once
</span></span></span><span style=display:flex><span>    __m256 va <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#d2a8ff;font-weight:700>_mm256_load_ps</span>(<span style=color:#ff7b72;font-weight:700>&amp;</span>a[i]);
</span></span><span style=display:flex><span>    __m256 vb <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#d2a8ff;font-weight:700>_mm256_load_ps</span>(<span style=color:#ff7b72;font-weight:700>&amp;</span>b[i]);
</span></span><span style=display:flex><span>    __m256 vc <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#d2a8ff;font-weight:700>_mm256_add_ps</span>(va, vb);
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>_mm256_store_ps</span>(<span style=color:#ff7b72;font-weight:700>&amp;</span>c[i], vc);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Modern compilers auto-vectorize when possible:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-bash" data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Enable vectorization reports</span>
</span></span><span style=display:flex><span>clang -O2 -Rpass<span style=color:#ff7b72;font-weight:700>=</span>loop-vectorize file.c
</span></span><span style=display:flex><span>gcc -O2 -fopt-info-vec-optimized file.c
</span></span></code></pre></div><h3 id="46-loop-tiling-blocking">4.6 Loop Tiling (Blocking)</h3><p>Improve cache utilization for nested loops:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Before (matrix multiply - poor cache use)
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> N; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> j <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; j <span style=color:#ff7b72;font-weight:700>&lt;</span> N; j<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> k <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; k <span style=color:#ff7b72;font-weight:700>&lt;</span> N; k<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>            C[i][j] <span style=color:#ff7b72;font-weight:700>+=</span> A[i][k] <span style=color:#ff7b72;font-weight:700>*</span> B[k][j];
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// After tiling (64x64 blocks fit in L1 cache)
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-weight:700;font-style:italic>#define TILE 64
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> ii <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; ii <span style=color:#ff7b72;font-weight:700>&lt;</span> N; ii <span style=color:#ff7b72;font-weight:700>+=</span> TILE) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> jj <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; jj <span style=color:#ff7b72;font-weight:700>&lt;</span> N; jj <span style=color:#ff7b72;font-weight:700>+=</span> TILE) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> kk <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; kk <span style=color:#ff7b72;font-weight:700>&lt;</span> N; kk <span style=color:#ff7b72;font-weight:700>+=</span> TILE) {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> ii; i <span style=color:#ff7b72;font-weight:700>&lt;</span> ii <span style=color:#ff7b72;font-weight:700>+</span> TILE; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> j <span style=color:#ff7b72;font-weight:700>=</span> jj; j <span style=color:#ff7b72;font-weight:700>&lt;</span> jj <span style=color:#ff7b72;font-weight:700>+</span> TILE; j<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>                    <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> k <span style=color:#ff7b72;font-weight:700>=</span> kk; k <span style=color:#ff7b72;font-weight:700>&lt;</span> kk <span style=color:#ff7b72;font-weight:700>+</span> TILE; k<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>                        C[i][j] <span style=color:#ff7b72;font-weight:700>+=</span> A[i][k] <span style=color:#ff7b72;font-weight:700>*</span> B[k][j];
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id="5-memory-optimizations">5. Memory Optimizations</h2><p>Optimizations targeting memory access patterns.</p><h3 id="51-scalar-replacement-of-aggregates-sroa">5.1 Scalar Replacement of Aggregates (SROA)</h3><p>Break structs into individual variables:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Before
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>struct</span> Point { <span style=color:#ff7b72>int</span> x, y; };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> <span style=color:#d2a8ff;font-weight:700>distance_squared</span>(<span style=color:#ff7b72>struct</span> Point p) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> p.x <span style=color:#ff7b72;font-weight:700>*</span> p.x <span style=color:#ff7b72;font-weight:700>+</span> p.y <span style=color:#ff7b72;font-weight:700>*</span> p.y;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// After SROA (at call site)
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> <span style=color:#d2a8ff;font-weight:700>distance_squared</span>(<span style=color:#ff7b72>int</span> p_x, <span style=color:#ff7b72>int</span> p_y) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> p_x <span style=color:#ff7b72;font-weight:700>*</span> p_x <span style=color:#ff7b72;font-weight:700>+</span> p_y <span style=color:#ff7b72;font-weight:700>*</span> p_y;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This enables register allocation for struct members.</p><h3 id="52-memory-to-register-promotion">5.2 Memory to Register Promotion</h3><p>Keep variables in registers instead of memory:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Before (conceptual C, showing memory operations)
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>compute</span>(<span style=color:#ff7b72>int</span> <span style=color:#ff7b72;font-weight:700>*</span>result) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>int</span> temp;            <span style=color:#8b949e;font-style:italic>// On stack
</span></span></span><span style=display:flex><span>    temp <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>5</span>;            <span style=color:#8b949e;font-style:italic>// Store to memory
</span></span></span><span style=display:flex><span>    temp <span style=color:#ff7b72;font-weight:700>=</span> temp <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>3</span>;     <span style=color:#8b949e;font-style:italic>// Load, add, store
</span></span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>*</span>result <span style=color:#ff7b72;font-weight:700>=</span> temp <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>2</span>;  <span style=color:#8b949e;font-style:italic>// Load, multiply, store
</span></span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// After mem2reg
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>compute</span>(<span style=color:#ff7b72>int</span> <span style=color:#ff7b72;font-weight:700>*</span>result) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>int</span> temp <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>5</span>;        <span style=color:#8b949e;font-style:italic>// In register
</span></span></span><span style=display:flex><span>    temp <span style=color:#ff7b72;font-weight:700>=</span> temp <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>3</span>;     <span style=color:#8b949e;font-style:italic>// Register operation
</span></span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>*</span>result <span style=color:#ff7b72;font-weight:700>=</span> temp <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>2</span>;  <span style=color:#8b949e;font-style:italic>// Single store
</span></span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id="53-loadstore-elimination">5.3 Load/Store Elimination</h3><p>Remove redundant memory operations:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Before
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>update</span>(<span style=color:#ff7b72>int</span> <span style=color:#ff7b72;font-weight:700>*</span>ptr) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>*</span>ptr <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>10</span>;       <span style=color:#8b949e;font-style:italic>// Store
</span></span></span><span style=display:flex><span>    <span style=color:#ff7b72>int</span> x <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72;font-weight:700>*</span>ptr;    <span style=color:#8b949e;font-style:italic>// Load (redundant - we just stored 10)
</span></span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>*</span>ptr <span style=color:#ff7b72;font-weight:700>=</span> x <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>1</span>;    <span style=color:#8b949e;font-style:italic>// Store
</span></span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// After elimination
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>update</span>(<span style=color:#ff7b72>int</span> <span style=color:#ff7b72;font-weight:700>*</span>ptr) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>*</span>ptr <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>11</span>;       <span style=color:#8b949e;font-style:italic>// Single store
</span></span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id="54-alias-analysis">5.4 Alias Analysis</h3><p>Determine if pointers can refer to the same memory:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Can these be optimized?
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>compute</span>(<span style=color:#ff7b72>int</span> <span style=color:#ff7b72;font-weight:700>*</span>a, <span style=color:#ff7b72>int</span> <span style=color:#ff7b72;font-weight:700>*</span>b, <span style=color:#ff7b72>int</span> <span style=color:#ff7b72;font-weight:700>*</span>c) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>*</span>a <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72;font-weight:700>*</span>b <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#ff7b72;font-weight:700>*</span>c;
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>*</span>a <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72;font-weight:700>*</span>b <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#ff7b72;font-weight:700>*</span>c;  <span style=color:#8b949e;font-style:italic>// Redundant if a doesn&#39;t alias b or c
</span></span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// With restrict keyword (C99)
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>compute</span>(<span style=color:#ff7b72>int</span> <span style=color:#ff7b72;font-weight:700>*</span><span style=color:#ff7b72>restrict</span> a, <span style=color:#ff7b72>int</span> <span style=color:#ff7b72;font-weight:700>*</span><span style=color:#ff7b72>restrict</span> b, <span style=color:#ff7b72>int</span> <span style=color:#ff7b72;font-weight:700>*</span><span style=color:#ff7b72>restrict</span> c) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>*</span>a <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72;font-weight:700>*</span>b <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#ff7b72;font-weight:700>*</span>c;  <span style=color:#8b949e;font-style:italic>// Compiler knows a, b, c don&#39;t overlap
</span></span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// Second assignment definitely redundant
</span></span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id="55-prefetching">5.5 Prefetching</h3><p>Insert prefetch instructions for predictable access:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Compiler may insert prefetches for:
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> n; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// __builtin_prefetch(&amp;data[i + 16]);  // Implicit
</span></span></span><span style=display:flex><span>    sum <span style=color:#ff7b72;font-weight:700>+=</span> data[i];
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id="6-interprocedural-optimizations">6. Interprocedural Optimizations</h2><p>Optimizations across function boundaries.</p><h3 id="61-link-time-optimization-lto">6.1 Link-Time Optimization (LTO)</h3><p>Optimize across compilation units:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-bash" data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Compile with LTO</span>
</span></span><span style=display:flex><span>clang -O2 -flto file1.c file2.c -o program
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Benefits:</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># - Cross-file inlining</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># - Whole-program dead code elimination</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># - Better alias analysis</span>
</span></span></code></pre></div><h3 id="62-interprocedural-constant-propagation">6.2 Interprocedural Constant Propagation</h3><p>Propagate constants across functions:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// file1.c
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> <span style=color:#d2a8ff;font-weight:700>get_multiplier</span>() { <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>4</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// file2.c
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> <span style=color:#d2a8ff;font-weight:700>scale</span>(<span style=color:#ff7b72>int</span> x) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> x <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#d2a8ff;font-weight:700>get_multiplier</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// After IPCP with LTO
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> <span style=color:#d2a8ff;font-weight:700>scale</span>(<span style=color:#ff7b72>int</span> x) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> x <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>4</span>;  <span style=color:#8b949e;font-style:italic>// Or: x &lt;&lt; 2
</span></span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id="63-devirtualization">6.3 Devirtualization</h3><p>Replace virtual calls with direct calls:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-cpp" data-lang=cpp><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Before
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>Base</span> { <span style=color:#ff7b72>virtual</span> <span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>foo</span>() <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; };
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>Derived</span> <span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>public</span> Base { <span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>foo</span>() <span style=color:#ff7b72>override</span> { <span style=color:#8b949e;font-style:italic>/*...*/</span> } };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>call_foo</span>(Base<span style=color:#ff7b72;font-weight:700>*</span> b) {
</span></span><span style=display:flex><span>    b<span style=color:#ff7b72;font-weight:700>-&gt;</span>foo();  <span style=color:#8b949e;font-style:italic>// Virtual call through vtable
</span></span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// After devirtualization (when type is known)
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>call_foo</span>(Derived<span style=color:#ff7b72;font-weight:700>*</span> d) {
</span></span><span style=display:flex><span>    d<span style=color:#ff7b72;font-weight:700>-&gt;</span>Derived<span style=color:#ff7b72;font-weight:700>::</span>foo();  <span style=color:#8b949e;font-style:italic>// Direct call
</span></span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id="64-function-cloning">6.4 Function Cloning</h3><p>Create specialized versions for specific call sites:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Original
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>process</span>(<span style=color:#ff7b72>int</span> <span style=color:#ff7b72;font-weight:700>*</span>data, <span style=color:#ff7b72>int</span> n, <span style=color:#ff7b72>bool</span> reverse) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (reverse) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> n<span style=color:#ff7b72;font-weight:700>-</span><span style=color:#a5d6ff>1</span>; i <span style=color:#ff7b72;font-weight:700>&gt;=</span> <span style=color:#a5d6ff>0</span>; i<span style=color:#ff7b72;font-weight:700>--</span>) <span style=color:#d2a8ff;font-weight:700>process_item</span>(data[i]);
</span></span><span style=display:flex><span>    } <span style=color:#ff7b72>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> n; i<span style=color:#ff7b72;font-weight:700>++</span>) <span style=color:#d2a8ff;font-weight:700>process_item</span>(data[i]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// After cloning
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>process_forward</span>(<span style=color:#ff7b72>int</span> <span style=color:#ff7b72;font-weight:700>*</span>data, <span style=color:#ff7b72>int</span> n) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> n; i<span style=color:#ff7b72;font-weight:700>++</span>) <span style=color:#d2a8ff;font-weight:700>process_item</span>(data[i]);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>process_reverse</span>(<span style=color:#ff7b72>int</span> <span style=color:#ff7b72;font-weight:700>*</span>data, <span style=color:#ff7b72>int</span> n) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> n<span style=color:#ff7b72;font-weight:700>-</span><span style=color:#a5d6ff>1</span>; i <span style=color:#ff7b72;font-weight:700>&gt;=</span> <span style=color:#a5d6ff>0</span>; i<span style=color:#ff7b72;font-weight:700>--</span>) <span style=color:#d2a8ff;font-weight:700>process_item</span>(data[i]);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Call site uses appropriate clone based on known value
</span></span></span></code></pre></div><h2 id="7-target-specific-optimizations">7. Target-Specific Optimizations</h2><p>Optimizations that depend on the target architecture.</p><h3 id="71-instruction-selection">7.1 Instruction Selection</h3><p>Choose optimal instructions for the target:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Source
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> <span style=color:#d2a8ff;font-weight:700>count_ones</span>(<span style=color:#ff7b72>unsigned</span> <span style=color:#ff7b72>int</span> x) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>int</span> count <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>while</span> (x) {
</span></span><span style=display:flex><span>        count <span style=color:#ff7b72;font-weight:700>+=</span> x <span style=color:#ff7b72;font-weight:700>&amp;</span> <span style=color:#a5d6ff>1</span>;
</span></span><span style=display:flex><span>        x <span style=color:#ff7b72;font-weight:700>&gt;&gt;=</span> <span style=color:#a5d6ff>1</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> count;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// On x86 with POPCNT support
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> <span style=color:#d2a8ff;font-weight:700>count_ones</span>(<span style=color:#ff7b72>unsigned</span> <span style=color:#ff7b72>int</span> x) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> <span style=color:#d2a8ff;font-weight:700>__builtin_popcount</span>(x);  <span style=color:#8b949e;font-style:italic>// Single instruction
</span></span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id="72-register-allocation">7.2 Register Allocation</h3><p>Assign variables to physical registers:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-text" data-lang=text><span style=display:flex><span>Virtual registers:       Physical registers (x86-64):
</span></span><span style=display:flex><span>v1 = load a              rax = load a
</span></span><span style=display:flex><span>v2 = load b              rbx = load b
</span></span><span style=display:flex><span>v3 = v1 + v2             rcx = rax + rbx
</span></span><span style=display:flex><span>v4 = v3 * v1             rcx = rcx * rax
</span></span><span style=display:flex><span>store v4 → result        store rcx → result
</span></span></code></pre></div><p>Register pressure can force spills to memory, impacting performance.</p><h3 id="73-instruction-scheduling">7.3 Instruction Scheduling</h3><p>Reorder instructions to hide latency:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-asm" data-lang=asm><span style=display:flex><span><span style=color:#8b949e;font-style:italic>; Before (stalls waiting for load)
</span></span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>mov</span> <span style=color:#79c0ff;font-weight:700>rax</span>, [<span style=color:#79c0ff;font-weight:700>ptr1</span>]      <span style=color:#8b949e;font-style:italic>; Load (latency: 4 cycles)
</span></span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>add</span> <span style=color:#79c0ff;font-weight:700>rax</span>, <span style=color:#a5d6ff>1</span>           <span style=color:#8b949e;font-style:italic>; Must wait for load
</span></span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>mov</span> <span style=color:#79c0ff;font-weight:700>rbx</span>, [<span style=color:#79c0ff;font-weight:700>ptr2</span>]      <span style=color:#8b949e;font-style:italic>; Load
</span></span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>add</span> <span style=color:#79c0ff;font-weight:700>rbx</span>, <span style=color:#a5d6ff>2</span>           <span style=color:#8b949e;font-style:italic>; Must wait for load
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>; After scheduling (overlap latencies)
</span></span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>mov</span> <span style=color:#79c0ff;font-weight:700>rax</span>, [<span style=color:#79c0ff;font-weight:700>ptr1</span>]      <span style=color:#8b949e;font-style:italic>; Start load 1
</span></span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>mov</span> <span style=color:#79c0ff;font-weight:700>rbx</span>, [<span style=color:#79c0ff;font-weight:700>ptr2</span>]      <span style=color:#8b949e;font-style:italic>; Start load 2 (parallel)
</span></span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>add</span> <span style=color:#79c0ff;font-weight:700>rax</span>, <span style=color:#a5d6ff>1</span>           <span style=color:#8b949e;font-style:italic>; Load 1 ready by now
</span></span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>add</span> <span style=color:#79c0ff;font-weight:700>rbx</span>, <span style=color:#a5d6ff>2</span>           <span style=color:#8b949e;font-style:italic>; Load 2 ready by now
</span></span></span></code></pre></div><h3 id="74-simd-instruction-selection">7.4 SIMD Instruction Selection</h3><p>Choose appropriate vector instructions:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Compiler chooses based on target
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>float</span> sum <span style=color:#ff7b72;font-weight:700>=</span> a <span style=color:#ff7b72;font-weight:700>+</span> b;  <span style=color:#8b949e;font-style:italic>// scalar: addss
</span></span></span><span style=display:flex><span>                    <span style=color:#8b949e;font-style:italic>// SSE: addps (4 floats)
</span></span></span><span style=display:flex><span>                    <span style=color:#8b949e;font-style:italic>// AVX: vaddps (8 floats)
</span></span></span><span style=display:flex><span>                    <span style=color:#8b949e;font-style:italic>// AVX-512: vaddps (16 floats)
</span></span></span></code></pre></div><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-bash" data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Target specific architectures</span>
</span></span><span style=display:flex><span>clang -march<span style=color:#ff7b72;font-weight:700>=</span>skylake file.c      <span style=color:#8b949e;font-style:italic># Use Skylake instructions</span>
</span></span><span style=display:flex><span>clang -march<span style=color:#ff7b72;font-weight:700>=</span>native file.c       <span style=color:#8b949e;font-style:italic># Use current CPU&#39;s features</span>
</span></span><span style=display:flex><span>clang -mavx2 -mfma file.c        <span style=color:#8b949e;font-style:italic># Enable specific extensions</span>
</span></span></code></pre></div><h2 id="8-profile-guided-optimization-pgo">8. Profile-Guided Optimization (PGO)</h2><p>Use runtime data to guide optimization decisions.</p><h3 id="81-how-pgo-works">8.1 How PGO Works</h3><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-bash" data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Step 1: Build instrumented binary</span>
</span></span><span style=display:flex><span>clang -O2 -fprofile-generate file.c -o program_instrumented
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Step 2: Run with representative workload</span>
</span></span><span style=display:flex><span>./program_instrumented &lt; typical_input.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Step 3: Build optimized binary using profile</span>
</span></span><span style=display:flex><span>clang -O2 -fprofile-use<span style=color:#ff7b72;font-weight:700>=</span>default.profdata file.c -o program_optimized
</span></span></code></pre></div><h3 id="82-pgo-benefits">8.2 PGO Benefits</h3><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Without PGO: compiler guesses
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>if</span> (rarely_true) {     <span style=color:#8b949e;font-style:italic>// Compiler assumes 50/50
</span></span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>cold_path</span>();
</span></span><span style=display:flex><span>} <span style=color:#ff7b72>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>hot_path</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// With PGO: compiler knows actual frequencies
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>if</span> (rarely_true) {     <span style=color:#8b949e;font-style:italic>// Profile shows 0.1% taken
</span></span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>cold_path</span>();       <span style=color:#8b949e;font-style:italic>// Moved to separate cache line
</span></span></span><span style=display:flex><span>} <span style=color:#ff7b72>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>hot_path</span>();        <span style=color:#8b949e;font-style:italic>// Inlined, optimized aggressively
</span></span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>PGO improves:</p><ul><li>Branch prediction hints</li><li>Function inlining decisions</li><li>Basic block layout</li><li>Register allocation priorities</li></ul><h3 id="83-feedback-directed-optimization">8.3 Feedback-Directed Optimization</h3><p>Modern PGO uses sampling for low overhead:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-bash" data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># AutoFDO with Linux perf</span>
</span></span><span style=display:flex><span>perf record -b ./program  <span style=color:#8b949e;font-style:italic># Sample branches</span>
</span></span><span style=display:flex><span>create_llvm_prof --binary<span style=color:#ff7b72;font-weight:700>=</span>./program --profile<span style=color:#ff7b72;font-weight:700>=</span>perf.data --out<span style=color:#ff7b72;font-weight:700>=</span>program.afdo
</span></span><span style=display:flex><span>clang -O2 -fprofile-sample-use<span style=color:#ff7b72;font-weight:700>=</span>program.afdo file.c
</span></span></code></pre></div><h2 id="9-writing-optimizer-friendly-code">9. Writing Optimizer-Friendly Code</h2><p>Help the compiler help you.</p><h3 id="91-use-const-and-restrict">9.1 Use const and restrict</h3><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Help alias analysis
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>add_arrays</span>(
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>float</span> <span style=color:#ff7b72;font-weight:700>*</span><span style=color:#ff7b72>restrict</span> result,    <span style=color:#8b949e;font-style:italic>// result doesn&#39;t alias others
</span></span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> <span style=color:#ff7b72>float</span> <span style=color:#ff7b72;font-weight:700>*</span><span style=color:#ff7b72>restrict</span> a,   <span style=color:#8b949e;font-style:italic>// a is read-only
</span></span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> <span style=color:#ff7b72>float</span> <span style=color:#ff7b72;font-weight:700>*</span><span style=color:#ff7b72>restrict</span> b,   <span style=color:#8b949e;font-style:italic>// b is read-only
</span></span></span><span style=display:flex><span>    <span style=color:#ff7b72>int</span> n
</span></span><span style=display:flex><span>) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> n; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>        result[i] <span style=color:#ff7b72;font-weight:700>=</span> a[i] <span style=color:#ff7b72;font-weight:700>+</span> b[i];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Enables vectorization without runtime alias checks
</span></span></span></code></pre></div><h3 id="92-prefer-local-variables">9.2 Prefer Local Variables</h3><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Harder to optimize (could alias through ptr)
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>bad</span>(<span style=color:#ff7b72>int</span> <span style=color:#ff7b72;font-weight:700>*</span>ptr) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> <span style=color:#a5d6ff>100</span>; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72;font-weight:700>*</span>ptr <span style=color:#ff7b72;font-weight:700>+=</span> i;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Easier to optimize
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>good</span>(<span style=color:#ff7b72>int</span> <span style=color:#ff7b72;font-weight:700>*</span>ptr) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>int</span> sum <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72;font-weight:700>*</span>ptr;  <span style=color:#8b949e;font-style:italic>// Load once
</span></span></span><span style=display:flex><span>    <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> <span style=color:#a5d6ff>100</span>; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>        sum <span style=color:#ff7b72;font-weight:700>+=</span> i;    <span style=color:#8b949e;font-style:italic>// Register operation
</span></span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>*</span>ptr <span style=color:#ff7b72;font-weight:700>=</span> sum;      <span style=color:#8b949e;font-style:italic>// Store once
</span></span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id="93-avoid-pointer-aliasing">9.3 Avoid Pointer Aliasing</h3><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// May not vectorize (a and b might overlap)
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>copy_bad</span>(<span style=color:#ff7b72>int</span> <span style=color:#ff7b72;font-weight:700>*</span>a, <span style=color:#ff7b72>int</span> <span style=color:#ff7b72;font-weight:700>*</span>b, <span style=color:#ff7b72>int</span> n) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> n; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>        a[i] <span style=color:#ff7b72;font-weight:700>=</span> b[i] <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>2</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Will vectorize
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>copy_good</span>(<span style=color:#ff7b72>int</span> <span style=color:#ff7b72;font-weight:700>*</span><span style=color:#ff7b72>restrict</span> a, <span style=color:#ff7b72>int</span> <span style=color:#ff7b72;font-weight:700>*</span><span style=color:#ff7b72>restrict</span> b, <span style=color:#ff7b72>int</span> n) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> n; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>        a[i] <span style=color:#ff7b72;font-weight:700>=</span> b[i] <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>2</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id="94-use-appropriate-types">9.4 Use Appropriate Types</h3><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// size_t for array indexing
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>sum</span>(<span style=color:#ff7b72>int</span> <span style=color:#ff7b72;font-weight:700>*</span>arr, <span style=color:#ff7b72>size_t</span> n) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>int</span> sum <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>size_t</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> n; i<span style=color:#ff7b72;font-weight:700>++</span>) {  <span style=color:#8b949e;font-style:italic>// No sign extension needed
</span></span></span><span style=display:flex><span>        sum <span style=color:#ff7b72;font-weight:700>+=</span> arr[i];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Appropriate width for data
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>process</span>(<span style=color:#ff7b72>uint8_t</span> <span style=color:#ff7b72;font-weight:700>*</span>data, <span style=color:#ff7b72>int</span> n) {  <span style=color:#8b949e;font-style:italic>// 8-bit data
</span></span></span><span style=display:flex><span>    <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> n; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>        data[i] <span style=color:#ff7b72;font-weight:700>=</span> data[i] <span style=color:#ff7b72;font-weight:700>&gt;&gt;</span> <span style=color:#a5d6ff>1</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id="95-structure-data-for-vectorization">9.5 Structure Data for Vectorization</h3><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Array of Structures (AoS) - harder to vectorize
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>struct</span> Particle { <span style=color:#ff7b72>float</span> x, y, z, mass; };
</span></span><span style=display:flex><span><span style=color:#ff7b72>struct</span> Particle particles[N];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Structure of Arrays (SoA) - easier to vectorize
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>struct</span> Particles {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>float</span> x[N], y[N], z[N], mass[N];
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><h3 id="96-mark-unlikely-branches">9.6 Mark Unlikely Branches</h3><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-weight:700;font-style:italic>#define unlikely(x) __builtin_expect(!!(x), 0)
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-weight:700;font-style:italic>#define likely(x)   __builtin_expect(!!(x), 1)
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>process</span>(<span style=color:#ff7b72>int</span> <span style=color:#ff7b72;font-weight:700>*</span>data) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (<span style=color:#d2a8ff;font-weight:700>unlikely</span>(data <span style=color:#ff7b72;font-weight:700>==</span> NULL)) {
</span></span><span style=display:flex><span>        <span style=color:#d2a8ff;font-weight:700>handle_error</span>();
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// Hot path continues here
</span></span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id="10-debugging-compiler-optimizations">10. Debugging Compiler Optimizations</h2><p>When optimizations cause problems or you want to understand what&rsquo;s happening.</p><h3 id="101-viewing-optimization-passes">10.1 Viewing Optimization Passes</h3><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-bash" data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># LLVM: print all optimization passes</span>
</span></span><span style=display:flex><span>clang -O2 -mllvm -debug-pass<span style=color:#ff7b72;font-weight:700>=</span>Arguments file.c
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># GCC: dump optimization info</span>
</span></span><span style=display:flex><span>gcc -O2 -fdump-tree-all -fdump-rtl-all file.c
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># View generated assembly</span>
</span></span><span style=display:flex><span>clang -O2 -S -fverbose-asm file.c -o file.s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Compare optimization levels</span>
</span></span><span style=display:flex><span>diff &lt;<span style=color:#ff7b72;font-weight:700>(</span>clang -O0 -S file.c -o -<span style=color:#ff7b72;font-weight:700>)</span> &lt;<span style=color:#ff7b72;font-weight:700>(</span>clang -O2 -S file.c -o -<span style=color:#ff7b72;font-weight:700>)</span>
</span></span></code></pre></div><h3 id="102-optimization-reports">10.2 Optimization Reports</h3><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-bash" data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Clang optimization remarks</span>
</span></span><span style=display:flex><span>clang -O2 -Rpass<span style=color:#ff7b72;font-weight:700>=</span>inline -Rpass-missed<span style=color:#ff7b72;font-weight:700>=</span>inline file.c
</span></span><span style=display:flex><span>clang -O2 -Rpass<span style=color:#ff7b72;font-weight:700>=</span>loop-vectorize file.c
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># GCC optimization info</span>
</span></span><span style=display:flex><span>gcc -O2 -fopt-info-vec-all file.c
</span></span><span style=display:flex><span>gcc -O2 -fopt-info-inline-all file.c
</span></span></code></pre></div><h3 id="103-online-tools">10.3 Online Tools</h3><p>Compiler Explorer (godbolt.org) is invaluable:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-text" data-lang=text><span style=display:flex><span>Features:
</span></span><span style=display:flex><span>- Compare compilers and versions
</span></span><span style=display:flex><span>- View assembly in real-time
</span></span><span style=display:flex><span>- Diff different optimization levels
</span></span><span style=display:flex><span>- See which source maps to which assembly
</span></span></code></pre></div><h3 id="104-preventing-optimization-for-debugging">10.4 Preventing Optimization (for debugging)</h3><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Prevent optimization of a variable
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>volatile</span> <span style=color:#ff7b72>int</span> keep <span style=color:#ff7b72;font-weight:700>=</span> result;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Memory barrier (prevent reordering)
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>asm</span> <span style=color:#d2a8ff;font-weight:700>volatile</span>(<span style=color:#a5d6ff>&#34;&#34;</span> <span style=color:#ff7b72;font-weight:700>:::</span> <span style=color:#a5d6ff>&#34;memory&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Prevent function inlining
</span></span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>__attribute__</span>((noinline)) <span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>debug_function</span>() { ... }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Prevent all optimizations for a function
</span></span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>__attribute__</span>((optnone)) <span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>debug_function</span>() { ... }  <span style=color:#8b949e;font-style:italic>// Clang
</span></span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>__attribute__</span>((<span style=color:#d2a8ff;font-weight:700>optimize</span>(<span style=color:#a5d6ff>&#34;O0&#34;</span>))) <span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>debug_function</span>() { ... }  <span style=color:#8b949e;font-style:italic>// GCC
</span></span></span></code></pre></div><h2 id="11-advanced-topics">11. Advanced Topics</h2><h3 id="111-polyhedral-optimization">11.1 Polyhedral Optimization</h3><p>For complex loop nests, polyhedral compilation can find optimal transformations:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Complex loop nest
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> N; i<span style=color:#ff7b72;font-weight:700>++</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> j <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; j <span style=color:#ff7b72;font-weight:700>&lt;</span> M; j<span style=color:#ff7b72;font-weight:700>++</span>)
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> k <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; k <span style=color:#ff7b72;font-weight:700>&lt;</span> K; k<span style=color:#ff7b72;font-weight:700>++</span>)
</span></span><span style=display:flex><span>            C[i][j] <span style=color:#ff7b72;font-weight:700>+=</span> A[i][k] <span style=color:#ff7b72;font-weight:700>*</span> B[k][j];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Polyhedral model represents as:
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// { [i,j,k] : 0 &lt;= i &lt; N ∧ 0 &lt;= j &lt; M ∧ 0 &lt;= k &lt; K }
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Can automatically derive tiling, interchange, etc.
</span></span></span></code></pre></div><p>Tools like PLUTO and Polly (LLVM) use this approach.</p><h3 id="112-auto-parallelization">11.2 Auto-Parallelization</h3><p>Compilers can automatically parallelize some loops:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// With OpenMP
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-weight:700;font-style:italic>#pragma omp parallel for
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> n; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>    c[i] <span style=color:#ff7b72;font-weight:700>=</span> a[i] <span style=color:#ff7b72;font-weight:700>+</span> b[i];
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Auto-parallelization (GCC)
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// gcc -O2 -ftree-parallelize-loops=4 file.c
</span></span></span></code></pre></div><h3 id="113-sanitizer-aware-optimization">11.3 Sanitizer-Aware Optimization</h3><p>Compilers adjust optimizations when sanitizers are enabled:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-bash" data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># AddressSanitizer reduces some optimizations</span>
</span></span><span style=display:flex><span>clang -O2 -fsanitize<span style=color:#ff7b72;font-weight:700>=</span>address file.c
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># UndefinedBehaviorSanitizer affects transformations</span>
</span></span><span style=display:flex><span>clang -O2 -fsanitize<span style=color:#ff7b72;font-weight:700>=</span>undefined file.c
</span></span></code></pre></div><p>Some optimizations are disabled because they would mask bugs.</p><h3 id="114-whole-program-optimization-challenges">11.4 Whole-Program Optimization Challenges</h3><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-text" data-lang=text><span style=display:flex><span>Challenges:
</span></span><span style=display:flex><span>- Compilation time scales with program size
</span></span><span style=display:flex><span>- Memory usage can be extreme
</span></span><span style=display:flex><span>- Incremental rebuilds are slow
</span></span><span style=display:flex><span>- Debug info generation is complex
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Mitigations:
</span></span><span style=display:flex><span>- ThinLTO: scalable LTO with summary-based approach
</span></span><span style=display:flex><span>- Distributed LTO: parallelize across machines
</span></span><span style=display:flex><span>- Incremental LTO: cache and reuse work
</span></span></code></pre></div><h2 id="12-the-evolution-of-compiler-optimizations">12. The Evolution of Compiler Optimizations</h2><h3 id="121-historical-perspective">12.1 Historical Perspective</h3><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-text" data-lang=text><span style=display:flex><span>1950s: First optimizing compilers (FORTRAN)
</span></span><span style=display:flex><span>1970s: SSA form, dataflow analysis
</span></span><span style=display:flex><span>1980s: Interprocedural optimization
</span></span><span style=display:flex><span>1990s: Profile-guided optimization, SPEC benchmarks
</span></span><span style=display:flex><span>2000s: JIT compilation, LLVM emergence
</span></span><span style=display:flex><span>2010s: Auto-vectorization, polyhedral optimization
</span></span><span style=display:flex><span>2020s: ML-guided optimization, domain-specific compilation
</span></span></code></pre></div><h3 id="122-modern-trends">12.2 Modern Trends</h3><p><strong>Machine Learning for Compilation:</strong></p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-python" data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ML can learn optimization heuristics</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Instead of hand-tuned rules:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>if</span> loop_size <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>100</span> <span style=color:#ff7b72;font-weight:700>and</span> estimated_benefit <span style=color:#ff7b72;font-weight:700>&gt;</span> threshold:
</span></span><span style=display:flex><span>    inline()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Learn from data:</span>
</span></span><span style=display:flex><span>inline_probability <span style=color:#ff7b72;font-weight:700>=</span> ml_model<span style=color:#ff7b72;font-weight:700>.</span>predict(loop_features)
</span></span><span style=display:flex><span><span style=color:#ff7b72>if</span> inline_probability <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>0.7</span>:
</span></span><span style=display:flex><span>    inline()
</span></span></code></pre></div><p><strong>Domain-Specific Compilers:</strong></p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-text" data-lang=text><span style=display:flex><span>TensorFlow XLA:   ML computation graphs → optimized GPU/TPU code
</span></span><span style=display:flex><span>Halide:           Image processing → optimized parallel code
</span></span><span style=display:flex><span>MLIR:             Multi-level IR for domain-specific optimization
</span></span></code></pre></div><h3 id="123-compiler-correctness">12.3 Compiler Correctness</h3><p>Optimizations must preserve semantics:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// This transformation is WRONG
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Before: x - 1 &gt; y
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// After:  x &gt; y + 1  (incorrect if y + 1 overflows!)
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Compilers use formal verification and extensive testing
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// - Translation validation
</span></span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>-</span> Random <span style=color:#d2a8ff;font-weight:700>testing</span> (Csmith)
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// - Differential testing across compilers
</span></span></span></code></pre></div><h2 id="13-real-world-optimization-stories">13. Real-World Optimization Stories</h2><h3 id="131-the-famous-bounds-check-elimination">13.1 The Famous Bounds Check Elimination</h3><p>In a tight loop processing array elements, bounds checking can be expensive:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-java" data-lang=java><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Java-style array access with bounds checks</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>for</span><span style=color:#6e7681> </span>(<span style=color:#ff7b72>int</span><span style=color:#6e7681> </span>i<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>0;<span style=color:#6e7681> </span>i<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>&lt;</span><span style=color:#6e7681> </span>array.length;<span style=color:#6e7681> </span>i<span style=color:#ff7b72;font-weight:700>++</span>)<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>sum<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>+=</span><span style=color:#6e7681> </span>array<span style=color:#ff7b72;font-weight:700>[</span>i<span style=color:#ff7b72;font-weight:700>]</span>;<span style=color:#6e7681>  </span><span style=color:#8b949e;font-style:italic>// Implicit bounds check every iteration</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span>}<span style=color:#6e7681>
</span></span></span></code></pre></div><p>Modern JIT compilers (HotSpot, V8) recognize this pattern and eliminate redundant checks:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-text" data-lang=text><span style=display:flex><span>Analysis:
</span></span><span style=display:flex><span>- Loop bounds: 0 to array.length
</span></span><span style=display:flex><span>- Array index: i
</span></span><span style=display:flex><span>- Since 0 &lt;= i &lt; array.length, bounds check always passes
</span></span><span style=display:flex><span>- Hoist check outside loop or eliminate entirely
</span></span></code></pre></div><p>This optimization can provide 2-3x speedups in array-heavy code.</p><h3 id="132-string-interning-gone-wrong">13.2 String Interning Gone Wrong</h3><p>A production system exhibited puzzling performance characteristics:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-java" data-lang=java><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Original code</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>for</span><span style=color:#6e7681> </span>(String<span style=color:#6e7681> </span>s<span style=color:#6e7681> </span>:<span style=color:#6e7681> </span>data)<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>if</span><span style=color:#6e7681> </span>(s.equals(<span style=color:#a5d6ff>&#34;ACTIVE&#34;</span>))<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>activeCount<span style=color:#ff7b72;font-weight:700>++</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span>}<span style=color:#6e7681>
</span></span></span></code></pre></div><p>After profiling, the team discovered the JIT compiler wasn&rsquo;t optimizing <code>equals()</code> as expected. The solution was explicit string interning:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-java" data-lang=java><span style=display:flex><span><span style=color:#ff7b72>private</span><span style=color:#6e7681> </span><span style=color:#ff7b72>static</span><span style=color:#6e7681> </span><span style=color:#ff7b72>final</span><span style=color:#6e7681> </span>String<span style=color:#6e7681> </span>ACTIVE<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;ACTIVE&#34;</span>.intern();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>for</span><span style=color:#6e7681> </span>(String<span style=color:#6e7681> </span>s<span style=color:#6e7681> </span>:<span style=color:#6e7681> </span>data)<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>if</span><span style=color:#6e7681> </span>(s<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>==</span><span style=color:#6e7681> </span>ACTIVE)<span style=color:#6e7681> </span>{<span style=color:#6e7681>  </span><span style=color:#8b949e;font-style:italic>// Reference comparison after interning</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>activeCount<span style=color:#ff7b72;font-weight:700>++</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span>}<span style=color:#6e7681>
</span></span></span></code></pre></div><p>The lesson: understanding optimization limitations helps find workarounds.</p><h3 id="133-auto-vectorization-failures">13.3 Auto-Vectorization Failures</h3><p>A team optimized image processing code expecting auto-vectorization:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>brighten</span>(<span style=color:#ff7b72>uint8_t</span> <span style=color:#ff7b72;font-weight:700>*</span>pixels, <span style=color:#ff7b72>int</span> n, <span style=color:#ff7b72>int</span> amount) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> n; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>int</span> val <span style=color:#ff7b72;font-weight:700>=</span> pixels[i] <span style=color:#ff7b72;font-weight:700>+</span> amount;
</span></span><span style=display:flex><span>        pixels[i] <span style=color:#ff7b72;font-weight:700>=</span> val <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>255</span> <span style=color:#ff7b72;font-weight:700>?</span> <span style=color:#a5d6ff>255</span> <span style=color:#ff7b72;font-weight:700>:</span> val;  <span style=color:#8b949e;font-style:italic>// Saturation
</span></span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Checking compiler output revealed no vectorization. The issue was the saturation check creating control flow. The fix used intrinsics:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>brighten</span>(<span style=color:#ff7b72>uint8_t</span> <span style=color:#ff7b72;font-weight:700>*</span>pixels, <span style=color:#ff7b72>int</span> n, <span style=color:#ff7b72>int</span> amount) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>__m128i</span> vamount <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#d2a8ff;font-weight:700>_mm_set1_epi16</span>(amount);
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> n; i <span style=color:#ff7b72;font-weight:700>+=</span> <span style=color:#a5d6ff>16</span>) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>__m128i</span> vpix <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#d2a8ff;font-weight:700>_mm_loadu_si128</span>((<span style=color:#ff7b72>__m128i</span><span style=color:#ff7b72;font-weight:700>*</span>)<span style=color:#ff7b72;font-weight:700>&amp;</span>pixels[i]);
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// ... SIMD saturation arithmetic
</span></span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id="134-the-inlining-cliff">13.4 The Inlining Cliff</h3><p>A performance regression appeared after a &ldquo;minor&rdquo; code change:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-cpp" data-lang=cpp><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Before: 15 lines, always inlined
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> <span style=color:#d2a8ff;font-weight:700>fastPath</span>(Data<span style=color:#ff7b72;font-weight:700>&amp;</span> d) {
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// Simple computation
</span></span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> d.x <span style=color:#ff7b72;font-weight:700>+</span> d.y <span style=color:#ff7b72;font-weight:700>*</span> d.z;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// After: 52 lines, not inlined
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> <span style=color:#d2a8ff;font-weight:700>fastPath</span>(Data<span style=color:#ff7b72;font-weight:700>&amp;</span> d) {
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// Added validation, logging
</span></span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72;font-weight:700>!</span>d.valid) { log(<span style=color:#a5d6ff>&#34;invalid&#34;</span>); <span style=color:#ff7b72>return</span> <span style=color:#ff7b72;font-weight:700>-</span><span style=color:#a5d6ff>1</span>; }
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ... more code ...
</span></span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> d.x <span style=color:#ff7b72;font-weight:700>+</span> d.y <span style=color:#ff7b72;font-weight:700>*</span> d.z;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The function exceeded the inlining threshold, causing a 3x slowdown in the hot loop that called it. Solution: split into fast path (inlined) and slow path (not inlined).</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-cpp" data-lang=cpp><span style=display:flex><span><span style=color:#ff7b72>inline</span> <span style=color:#ff7b72>int</span> <span style=color:#d2a8ff;font-weight:700>fastPath</span>(Data<span style=color:#ff7b72;font-weight:700>&amp;</span> d) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (__builtin_expect(<span style=color:#ff7b72;font-weight:700>!</span>d.valid, <span style=color:#a5d6ff>0</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> slowPath(d);  <span style=color:#8b949e;font-style:italic>// Outlined error handling
</span></span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> d.x <span style=color:#ff7b72;font-weight:700>+</span> d.y <span style=color:#ff7b72;font-weight:700>*</span> d.z;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id="135-lto-unlocks-cross-module-inlining">13.5 LTO Unlocks Cross-Module Inlining</h3><p>A microservices framework showed surprising speedups with LTO:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-text" data-lang=text><span style=display:flex><span>Before LTO:
</span></span><span style=display:flex><span>- Each module compiled separately
</span></span><span style=display:flex><span>- Interface calls go through function pointers
</span></span><span style=display:flex><span>- Virtual dispatch for polymorphism
</span></span><span style=display:flex><span>- 15% CPU in call overhead
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>After LTO:
</span></span><span style=display:flex><span>- Whole-program visibility
</span></span><span style=display:flex><span>- Devirtualization of common patterns
</span></span><span style=display:flex><span>- Cross-module inlining
</span></span><span style=display:flex><span>- Call overhead reduced to 2%
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Result: 18% overall performance improvement
</span></span></code></pre></div><p>The key insight: modular code design doesn&rsquo;t mean modular compilation.</p><h2 id="14-compiler-optimization-pitfalls">14. Compiler Optimization Pitfalls</h2><h3 id="141-undefined-behavior-exploitation">14.1 Undefined Behavior Exploitation</h3><p>Compilers exploit undefined behavior aggressively:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#ff7b72>int</span> <span style=color:#d2a8ff;font-weight:700>foo</span>(<span style=color:#ff7b72>int</span> x) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (x <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>1</span> <span style=color:#ff7b72;font-weight:700>&gt;</span> x) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>1</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Optimized to (assuming signed overflow is UB):
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> <span style=color:#d2a8ff;font-weight:700>foo</span>(<span style=color:#ff7b72>int</span> x) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>1</span>;  <span style=color:#8b949e;font-style:italic>// Always true if no overflow
</span></span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This can remove security checks:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>vulnerable</span>(<span style=color:#ff7b72>char</span> <span style=color:#ff7b72;font-weight:700>*</span>buf, <span style=color:#ff7b72>int</span> len) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (len <span style=color:#ff7b72;font-weight:700>&gt;</span> MAX_LEN) <span style=color:#ff7b72>return</span>;  <span style=color:#8b949e;font-style:italic>// Bounds check
</span></span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (len <span style=color:#ff7b72;font-weight:700>&lt;</span> <span style=color:#a5d6ff>0</span>) <span style=color:#ff7b72>return</span>;        <span style=color:#8b949e;font-style:italic>// Negativity check
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// len + HEADER_SIZE might overflow!
</span></span></span><span style=display:flex><span>    <span style=color:#ff7b72>char</span> <span style=color:#ff7b72;font-weight:700>*</span>p <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#d2a8ff;font-weight:700>malloc</span>(len <span style=color:#ff7b72;font-weight:700>+</span> HEADER_SIZE);
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// Compiler might optimize assuming no overflow
</span></span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id="142-floating-point-optimization-dangers">14.2 Floating-Point Optimization Dangers</h3><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// -ffast-math can change results
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>float</span> sum <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>;
</span></span><span style=display:flex><span><span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> n; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>    sum <span style=color:#ff7b72;font-weight:700>+=</span> data[i];
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// With -ffast-math, compiler might reorder:
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// (a + b) + c != a + (b + c) in floating point!
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// This can cause reproducibility issues
</span></span></span></code></pre></div><p>Guidelines for floating-point:</p><ul><li>Use <code>-ffast-math</code> only when precision isn&rsquo;t critical</li><li>Consider <code>-ffp-contract=fast</code> for FMA without full fast-math</li><li>Test numerical stability after enabling optimizations</li></ul><h3 id="143-memory-model-violations">14.3 Memory Model Violations</h3><p>Optimizers assume single-threaded execution unless told otherwise:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Broken without synchronization
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> flag <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>;
</span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> data <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>producer</span>() {
</span></span><span style=display:flex><span>    data <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>42</span>;      <span style=color:#8b949e;font-style:italic>// Might be reordered after flag
</span></span></span><span style=display:flex><span>    flag <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>1</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>consumer</span>() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>while</span> (flag <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>0</span>);  <span style=color:#8b949e;font-style:italic>// Might be optimized to if (flag == 0) while(1);
</span></span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>use</span>(data);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The fix requires proper atomics or volatile:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-weight:700;font-style:italic>#include</span> <span style=color:#8b949e;font-weight:700;font-style:italic>&lt;stdatomic.h&gt;</span><span style=color:#8b949e;font-weight:700;font-style:italic>
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>atomic_int flag <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>;
</span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> data <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>producer</span>() {
</span></span><span style=display:flex><span>    data <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>42</span>;
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>atomic_store_explicit</span>(<span style=color:#ff7b72;font-weight:700>&amp;</span>flag, <span style=color:#a5d6ff>1</span>, memory_order_release);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>consumer</span>() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>while</span> (<span style=color:#d2a8ff;font-weight:700>atomic_load_explicit</span>(<span style=color:#ff7b72;font-weight:700>&amp;</span>flag, memory_order_acquire) <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>0</span>);
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>use</span>(data);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id="144-debug-vs-release-differences">14.4 Debug vs Release Differences</h3><p>Code that works in debug can break in release:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-cpp" data-lang=cpp><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Uninitialized in release, zero in debug
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> <span style=color:#d2a8ff;font-weight:700>compute</span>() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>int</span> result;  <span style=color:#8b949e;font-style:italic>// Uninitialized
</span></span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// Forgot assignment on some path
</span></span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> result;  <span style=color:#8b949e;font-style:italic>// UB in release, often 0 in debug
</span></span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Order-of-evaluation issues
</span></span></span><span style=display:flex><span>map[key] <span style=color:#ff7b72;font-weight:700>=</span> process(map[key]);
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Debug: predictable order
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Release: order undefined, map might rehash
</span></span></span></code></pre></div><h3 id="145-the-observer-effect">14.5 The Observer Effect</h3><p>Measuring performance can change it:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>hot_function</span>() {
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// Very tight loop
</span></span></span><span style=display:flex><span>    <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> <span style=color:#a5d6ff>1000000</span>; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>        result <span style=color:#ff7b72;font-weight:700>+=</span> data[i];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Adding timing code:
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>hot_function</span>() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>auto</span> start <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#d2a8ff;font-weight:700>now</span>();  <span style=color:#8b949e;font-style:italic>// Prevents some optimizations
</span></span></span><span style=display:flex><span>    <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>int</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> <span style=color:#a5d6ff>1000000</span>; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>        result <span style=color:#ff7b72;font-weight:700>+=</span> data[i];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>auto</span> end <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#d2a8ff;font-weight:700>now</span>();
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>log</span>(end <span style=color:#ff7b72;font-weight:700>-</span> start);  <span style=color:#8b949e;font-style:italic>// Side effect changes optimization
</span></span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Solutions include:</p><ul><li>Use sampling profilers (perf, VTune)</li><li>Profile release builds</li><li>Minimize instrumentation</li></ul><h2 id="15-the-future-of-compiler-optimization">15. The Future of Compiler Optimization</h2><h3 id="151-machine-learning-integration">15.1 Machine Learning Integration</h3><p>Modern compilers are beginning to incorporate ML:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-text" data-lang=text><span style=display:flex><span>Traditional approach:
</span></span><span style=display:flex><span>- Hand-tuned heuristics
</span></span><span style=display:flex><span>- if (loop_count &gt; 100 &amp;&amp; benefit &gt; cost) inline()
</span></span><span style=display:flex><span>- Requires expert knowledge, often suboptimal
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ML approach:
</span></span><span style=display:flex><span>- Learn from millions of programs
</span></span><span style=display:flex><span>- Predict optimal decisions
</span></span><span style=display:flex><span>- Adapt to new architectures automatically
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Research examples:
</span></span><span style=display:flex><span>- Google&#39;s ML inlining for LLVM
</span></span><span style=display:flex><span>- Microsoft&#39;s learning-based register allocation
</span></span><span style=display:flex><span>- Intel&#39;s ML-guided code generation
</span></span></code></pre></div><h3 id="152-domain-specific-compilation">15.2 Domain-Specific Compilation</h3><p>Specialized compilers for specific domains:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-python" data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># TensorFlow XLA compiles computation graphs</span>
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@tf.function</span>(jit_compile<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>True</span>)
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>model</span>(x):
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> tf<span style=color:#ff7b72;font-weight:700>.</span>matmul(x, w) <span style=color:#ff7b72;font-weight:700>+</span> b
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># XLA optimizations:</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># - Fuse operations (matmul + add → single kernel)</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># - Optimize memory layout for hardware</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># - Generate code for GPU/TPU</span>
</span></span></code></pre></div><p>Similar patterns exist for:</p><ul><li>Image processing (Halide)</li><li>Database queries (query compilers)</li><li>Cryptography (specialized constant-time compilation)</li></ul><h3 id="153-hardware-software-co-design">15.3 Hardware-Software Co-Design</h3><p>As hardware becomes more specialized, compilers adapt:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-text" data-lang=text><span style=display:flex><span>Modern challenges:
</span></span><span style=display:flex><span>- Heterogeneous systems (CPU + GPU + TPU + FPGA)
</span></span><span style=display:flex><span>- Memory hierarchies (L1/L2/L3/HBM/DRAM/SSD)
</span></span><span style=display:flex><span>- Power constraints (frequency scaling, dark silicon)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Compiler responses:
</span></span><span style=display:flex><span>- Unified IR across accelerators (MLIR)
</span></span><span style=display:flex><span>- Automatic data placement and movement
</span></span><span style=display:flex><span>- Power-aware optimization passes
</span></span></code></pre></div><h3 id="154-security-focused-compilation">15.4 Security-Focused Compilation</h3><p>Compilers increasingly target security:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-c" data-lang=c><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Stack canaries
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>vulnerable</span>() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>char</span> buffer[<span style=color:#a5d6ff>64</span>];
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// Compiler inserts: canary = random_value
</span></span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>gets</span>(buffer);
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// Compiler inserts: if (canary != expected) abort()
</span></span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Control-Flow Integrity
</span></span></span><span style=display:flex><span><span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>call_function</span>(<span style=color:#ff7b72>void</span> (<span style=color:#ff7b72;font-weight:700>*</span>fptr)()) {
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// Compiler inserts: verify fptr in allowed targets
</span></span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>fptr</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Emerging techniques:</p><ul><li>Pointer authentication (ARM PA)</li><li>Shadow stacks</li><li>Memory tagging (MTE)</li></ul><h3 id="155-verified-compilation">15.5 Verified Compilation</h3><p>Ensuring optimizations preserve correctness:</p><div class="highlight"><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class="language-text" data-lang=text><span style=display:flex><span>CompCert: Formally verified C compiler
</span></span><span style=display:flex><span>- Mathematical proof of correctness
</span></span><span style=display:flex><span>- Guarantees: compiled code behaves like source
</span></span><span style=display:flex><span>- Used in safety-critical domains (aviation, medical)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Challenges:
</span></span><span style=display:flex><span>- Verification effort is substantial
</span></span><span style=display:flex><span>- Performance gap with production compilers
</span></span><span style=display:flex><span>- Limited optimization scope
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Future: combining formal methods with aggressive optimization
</span></span></code></pre></div><h2 id="16-summary">16. Summary</h2><p>Modern compilers apply sophisticated transformations to make code fast:</p><p><strong>Scalar optimizations:</strong></p><ul><li>Constant folding and propagation</li><li>Dead code elimination</li><li>Common subexpression elimination</li><li>Strength reduction</li></ul><p><strong>Control flow optimizations:</strong></p><ul><li>Function inlining</li><li>Branch elimination</li><li>Tail call optimization</li></ul><p><strong>Loop optimizations:</strong></p><ul><li>Unrolling and vectorization</li><li>Fusion, fission, and interchange</li><li>Loop-invariant code motion</li><li>Tiling for cache</li></ul><p><strong>Memory optimizations:</strong></p><ul><li>Register promotion</li><li>Load/store elimination</li><li>Alias analysis</li></ul><p><strong>Interprocedural optimizations:</strong></p><ul><li>Link-time optimization</li><li>Devirtualization</li><li>Cross-module inlining</li></ul><p><strong>Target-specific optimizations:</strong></p><ul><li>Instruction selection</li><li>Register allocation</li><li>SIMD vectorization</li></ul><p>Key takeaways:</p><ol><li><strong>Trust the compiler:</strong> Modern compilers are remarkably good</li><li><strong>Write clear code:</strong> Let the compiler optimize; focus on readability</li><li><strong>Help when needed:</strong> Use restrict, const, and hints judiciously</li><li><strong>Profile first:</strong> Don&rsquo;t optimize blindly; measure</li><li><strong>Understand limits:</strong> Some optimizations need source-level changes</li></ol><p>Understanding compiler optimizations makes you a better programmer. You&rsquo;ll write code that compilers can optimize effectively, diagnose performance issues more quickly, and appreciate the incredible engineering in modern compilation systems.</p></div><footer class="ce1a612 c6dfb1e c3ecea6"><div class="c364589">Categories:
<a href=/categories/systems/>systems</a>, <a href=/categories/compilers/>compilers</a></div><div>Tags:
<a href=/tags/compilers/>#compilers</a>, <a href=/tags/optimization/>#optimization</a>, <a href=/tags/performance/>#performance</a>, <a href=/tags/llvm/>#llvm</a>, <a href=/tags/systems/>#systems</a>, <a href=/tags/programming-languages/>#programming-languages</a></div></footer></article></main><footer class="ccdf0e8" role=contentinfo aria-label=Footer><div class="cfdda01 c133889 c5df473 c0eecc8 c69618a c6942b3 c03620d c2a9f27 c7c11d8 c82c52d c14527b"><div class="c6dfb1e c3ecea6 c39ef11 c88ae6f">&copy; 2026 Leonardo Benicio. All rights
reserved.</div><div class="c6942b3 c7c11d8 cd1fd22"><a href=https://github.com/lbenicio target=_blank rel="noopener noreferrer" aria-label=GitHub class="c1d6c20 c7c11d8 c1d0018 cd1fd22 cb5c327 c10dda9 c6dfb1e cbbda39 cfc01c7 c01f421 c286dd7 c2bd687 cfdce1d cfef18f c000b66 cf55a7b c514027"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 22v-4a4.8 4.8.0 00-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35.0-3.5.0.0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35.0 3.5A5.403 5.403.0 004 9c0 3.5 3 5.5 6 5.5-.39.5-.67 1.08-.82 1.7s-.2 1.27-.18 1.9V22"/></svg>
<span class="cba5854">GitHub</span>
</a><a href=https://www.linkedin.com/in/leonardo-benicio target=_blank rel="noopener noreferrer" aria-label=LinkedIn class="c1d6c20 c7c11d8 c1d0018 cd1fd22 cb5c327 c10dda9 c6dfb1e cbbda39 cfc01c7 c01f421 c286dd7 c2bd687 cfdce1d cfef18f c000b66 cf55a7b c514027"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452H17.21V14.86c0-1.333-.027-3.046-1.858-3.046-1.86.0-2.145 1.45-2.145 2.948v5.69H9.069V9h3.112v1.561h.044c.434-.82 1.494-1.686 3.074-1.686 3.29.0 3.897 2.165 3.897 4.983v6.594zM5.337 7.433a1.805 1.805.0 11-.002-3.61 1.805 1.805.0 01.002 3.61zM6.763 20.452H3.911V9h2.852v11.452z"/></svg>
<span class="cba5854">LinkedIn</span>
</a><a href=https://twitter.com/lbenicio_ target=_blank rel="noopener noreferrer" aria-label=Twitter class="c1d6c20 c7c11d8 c1d0018 cd1fd22 cb5c327 c10dda9 c6dfb1e cbbda39 cfc01c7 c01f421 c286dd7 c2bd687 cfdce1d cfef18f c000b66 cf55a7b c514027"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M19.633 7.997c.013.177.013.354.013.53.0 5.386-4.099 11.599-11.6 11.599-2.31.0-4.457-.676-6.265-1.842.324.038.636.05.972.05 1.91.0 3.67-.65 5.07-1.755a4.099 4.099.0 01-3.827-2.84c.25.039.5.064.763.064.363.0.726-.051 1.065-.139A4.091 4.091.0 012.542 9.649v-.051c.538.3 1.162.482 1.824.507A4.082 4.082.0 012.54 6.7c0-.751.2-1.435.551-2.034a11.63 11.63.0 008.44 4.281 4.615 4.615.0 01-.101-.938 4.091 4.091.0 017.078-2.799 8.1 8.1.0 002.595-.988 4.112 4.112.0 01-1.8 2.261 8.2 8.2.0 002.357-.638A8.824 8.824.0 0119.613 7.96z"/></svg>
<span class="cba5854">Twitter</span></a></div></div></footer></body></html>